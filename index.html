<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="new/js/fabric.js"></script>
    <script src="new/js/angular.min.js"></script>
    <title></title>
  </head>
  <style media="screen">
    .jumbotron{ padding: 5px;}

  </style>
  <body>
    <div class="container-fluid">
      <div class="jumbotron">
        <h2 class="text-center" >Canvas App</h2>
      </div>
    </div>
    <div class="container-fluid">
        <div class="row">

          <div class="col-xs-2">
              <button type="button" class="btn btn-primary" name="button" onclick="Pen();" > Pen </button> <br> <br>
              <input type="range" name="points" id="sizechange" min="1" max="20" value="1" onchange="SetSize();"> <br>
              <input type="color" value="#000000" id="colorchange" onchange="SetColor();"> <br> <br>
              <div class="dropdown">
                  <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Shapes
                    <span class="caret"></span></button>
                    <ul class="dropdown-menu">
                    <!--  <li><a onclick="Pen()" >freeDraw</a></li> -->
                      <li><a onclick="Circle()">Circle</a></li>
                      <li><a onclick="Rectangle()">Rectangle</a></li>
                      <li><a onclick="Triangle()">Triangle</a></li>
                    </ul>
                </div>
                <br>
            <button type="button" class="btn btn-primary" name="button" onclick="Move();"> Move </button>

          </div>

          <div class="col-xs-8">
              <canvas id="canvas" width="800" height="400" style="border:1px solid;" ></canvas>
          </div>

        </div>
    </div>

    <script>
      var color='#000000';
      var size = 1;
      var rect, circle, triangle, isDown, origX, origY;
      var canvas = new fabric.Canvas('canvas');
      canvas.freeDrawingBrush.color = color;

      function SetColor()
       {
         color = document.getElementById("colorchange").value;
         canvas.freeDrawingBrush.color = color;
       }

       function SetSize()
      {
          size = document.getElementById("sizechange").value;
          canvas.freeDrawingBrush.width = size;
       }

      function Rectangle()
       {
          canvas.isDrawingMode = false;
          canvas.selection = false;
          canvas.on('mouse:down', function(o){
           isDown = true;
           var pointer = canvas.getPointer(o.e);
           origX = pointer.x;
           origY = pointer.y;
           var pointer = canvas.getPointer(o.e);
            rect = new fabric.Rect({
              left: origX,
              top: origY,
              originX: 'left',
              originY: 'top',
              width: pointer.x-origX,
              height: pointer.y-origY,
              fill:'',
              strokeWidth:3,
              stroke:color
              //transparentCorners: false
           });
           canvas.add(rect);
         });

         canvas.on('mouse:move', function(o){
           if (!isDown) return;
           var pointer = canvas.getPointer(o.e);

           if(origX>pointer.x){
             rect.set({ left: Math.abs(pointer.x) });
           }
           if(origY>pointer.y){
             rect.set({ top: Math.abs(pointer.y) });
           }

           rect.set({ width: Math.abs(origX - pointer.x) });
           rect.set({ height: Math.abs(origY - pointer.y) });


           canvas.renderAll();
         });

         canvas.on('mouse:up', function(o){
           isDown = false;
          });
       }


       function Circle() {
         canvas.isDrawingMode = false;
         canvas.selection = false;
         canvas.on('mouse:down', function(o){
          isDown = true;
          var pointer = canvas.getPointer(o.e);
          origX = pointer.x;
          origY = pointer.y;
          var pointer = canvas.getPointer(o.e);
           circle = new fabric.Circle({
             left: origX,
             top: origY,
             originX: 'left',
             originY: 'top',
             radius: (pointer.x-origX)/2,
             fill:'',
             strokeWidth:3,
             stroke:color
             //transparentCorners: false
          });
          canvas.add(circle);
        });

        canvas.on('mouse:move', function(o){
          if (!isDown) return;
          var pointer = canvas.getPointer(o.e);

          if(origX>pointer.x){ //when drag upside
            circle.set({ left: Math.abs(pointer.x) });
          }
          if(origY>pointer.y){
            circle.set({ top: Math.abs(pointer.y) });
          }

          circle.set({ radius: Math.abs(origX - pointer.x)/2 });

          canvas.renderAll();
        });

        canvas.on('mouse:up', function(o){
          isDown = false;
         });
       }

       function Triangle()
        {
            canvas.isDrawingMode = false;
            canvas.selection = false;
            canvas.on('mouse:down', function(o){
                isDown = true;
                var pointer = canvas.getPointer(o.e);
                origX = pointer.x;
                origY = pointer.y;
                var pointer = canvas.getPointer(o.e);

                 triangle = new fabric.Triangle({
                  left: origX,
                  top: origY,
                  originX: 'left',
                  originY: 'top',
                  fill:'',
                  strokeWidth:3,
                  stroke:color
                });
                canvas.add(triangle);

            });

            canvas.on('mouse:move', function(o){
                if (!isDown) return;
                var pointer = canvas.getPointer(o.e);

                if(origX>pointer.x){
                  triangle.set({ left: Math.abs(pointer.x) });
                }
                if(origY>pointer.y){
                  triangle.set({ top: Math.abs(pointer.y) });
                }

                triangle.set({ width: Math.abs(origX - pointer.x) });
                triangle.set({ height: Math.abs(origY - pointer.y) });
                canvas.renderAll();
            });

            canvas.on('mouse:up', function(o){
              isDown = false;
             });

        }


       function Move()
        {
          canvas.isDrawingMode = false;
          canvas.selection = true;
          canvas.off('mouse:down');
          canvas.off('mouse:move');
          canvas.off('mouse:up');
       }

       function Pen()
      {
          canvas.freeDrawingBrush.width = size;
          canvas.isDrawingMode = true;
       }

    </script>
  </body>
</html>
